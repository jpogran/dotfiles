#!/bin/bash
# Script to configure terminal settings across platforms
# {{ if eq .chezmoi.os "darwin" }}
# macOS-specific terminal configuration
configure_terminal() {
  local terminal="{{ .data.macos.terminal }}"
  echo "Configuring $terminal on macOS..."

  case "$terminal" in
    "iterm2")
      # Set iTerm2 preferences directory
      defaults write com.googlecode.iterm2 PrefsCustomFolder -string "~/.config/iterm2"
      defaults write com.googlecode.iterm2 LoadPrefsFromCustomFolder -bool true

      # Apply theme colors
      if [ "{{ .data.theme.name }}" = "github_dark" ]; then
        echo "Applying GitHub Dark theme to iTerm2..."
        # These are just examples - in practice you'd have more comprehensive settings
        defaults write com.googlecode.iterm2 "Custom Color Presets" -dict-add "GitHub Dark" '{
          "Ansi 0 Color" = { "Blue Component" = 0.0; "Green Component" = 0.0; "Red Component" = 0.0; };
          "Background Color" = { "Blue Component" = 0.086; "Green Component" = 0.066; "Red Component" = 0.050; };
          "Foreground Color" = { "Blue Component" = 0.847; "Green Component" = 0.819; "Red Component" = 0.788; };
          "Cursor Color" = { "Blue Component" = 0.388; "Green Component" = 0.505; "Red Component" = 0.968; };
        }'
      fi
      ;;

    "warp")
      echo "Configuring Warp terminal..."
      # Add Warp-specific settings
      ;;

    *)
      echo "No specific configuration for $terminal"
      ;;
  esac
}
{{ else if eq .chezmoi.os "linux" }}
# Linux-specific terminal configuration
configure_terminal() {
  local terminal="{{ .data.linux.terminal }}"
  echo "Configuring $terminal on Linux..."

  case "$terminal" in
    "ghostty")
      # Ensure ghostty config directory exists
      mkdir -p ~/.config/ghostty

      # Apply theme settings via template (already done by chezmoi)
      ;;

    "alacritty")
      # Ensure alacritty config directory exists
      mkdir -p ~/.config/alacritty

      # Apply theme settings
      ;;

    *)
      echo "No specific configuration for $terminal"
      ;;
  esac
}
{{ else if eq .chezmoi.os "windows" }}
# Windows-specific terminal configuration
configure_terminal() {
  local terminal="{{ .data.windows.terminal }}"
  echo "Configuring $terminal on Windows..."

  case "$terminal" in
    "windows-terminal")
      # Windows Terminal settings are handled via the JSON template
      echo "Windows Terminal settings applied via template"
      ;;

    *)
      echo "No specific configuration for $terminal"
      ;;
  esac
}
{{ end }}

# Run the configuration
configure_terminal

# Set up common terminal preferences regardless of platform
echo "Setting up common terminal preferences..."

# Configure shell integration for supported terminals
{{ if eq .chezmoi.os "darwin" }}
# macOS-specific shell integration
if [ "{{ .data.macos.terminal }}" = "iterm2" ]; then
  # Ensure shell integration is installed for supported shells
  for shell in bash zsh fish; do
    if command -v $shell &> /dev/null; then
      echo "Installing iTerm2 shell integration for $shell..."
      curl -L https://iterm2.com/shell_integration/$shell -o ~/.iterm2_shell_integration.$shell
    fi
  done
fi
{{ end }}
